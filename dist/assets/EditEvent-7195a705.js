import{b as p,o,c as d,d as l,a as t,f as u,v as h,u as r,h as V,t as E,F as v,r as f,w as k,A as z,p as b,g}from"./index-1c3ab2de.js";import{s as w}from"./calendar.esm-c14d6f14.js";import{s as D}from"./confirmpopup.esm-28db405b.js";import{m as _}from"./index-26c1034e.js";const S={class:""},F=t("h4",{class:"bold text-primary mb-3 mt-2"},"Update Event",-1),U={class:"row"},C={class:"col-12 col-md-6"},L=t("label",{class:"fw-bold mb-1"}," Title ",-1),B={class:"col-12 col-md-6"},j=t("label",{class:"fw-bold mb-1"}," Description ",-1),A={class:"col-12 col-md-6"},N={class:"mb-3"},T=t("label",{class:"fw-bold mb-1"}," Start date ",-1),I={class:"text-muted"},M={class:"col-12 col-md-6"},O={class:"mb-3"},R=t("label",{class:"fw-bold mb-1"}," End date ",-1),q={class:"col-12 col-md-6"},H={class:"mb-3"},Z=t("label",{class:"fw-bold mb-1"}," Venue ",-1),G={class:"col-12 col-md-12"},J={class:"mb-3 d-flex flex-wrap"},K=t("div",{class:"fw-bold mb-1 w-100"},"Add files",-1),P=t("br",null,null,-1),Q={class:"fw-bold mb-1",for:"files"},W={class:"py-4 px-3 bg-primary rounded-7"},X={class:"p-1 me-2 position-relative rounded-7 overflow-hidden w-fit",style:{"max-width":"160px",height:"200px"}},Y=["src"],x={class:"p-1 me-2 position-relative rounded-7 overflow-hidden w-fit",style:{"max-width":"160px",height:"200px"}},ee=["src"],te=t("button",{class:"btn btn-primary mt-3 mb-4 py-3 py-md-2 w-100 w-lg-fit",type:"submit"}," update Event ",-1),se={name:"HomeView",components:{},data(){const s=_.tz.names();return{event:{title:"",description:""},venue:{},files:[],zones:s}},methods:{getFormData(){const s=new FormData;return this.event.start=new Date(this.event.start).toLocaleString(),this.event.end=new Date(this.event.end).toLocaleString(),this.event.time_zone=_.tz(this.event.time_zone).zoneName(),s.append("title",this.event.title),s.append("description",this.event.description),s.append("start",this.event.start),s.append("end",this.event.end),s.append("venue_id",this.venue.id),s.append("time_zone",this.event.time_zone),this.files.forEach(e=>s.append("files[]",e)),s},async updateEvent(){if(console.log(Object.keys(this.event).length),Object.keys(this.event).length<6){this.$toast.error("All fields are required");return}const s=this.getFormData();this.$widget.openLoading();const e=await this.$store.dispatch("updateEventService",{data:s,id:this.event.id});if(this.$widget.dismiss(),e.success){this.$toast.success("Event has been successfully updated"),location.href="/event/"+this.event.id;return}const i=this.$widget.getValidationError(e.errorMessage,"Could not update event");this.$toast.error(i)},getUrl(s){return URL.createObjectURL(s)},updateFiles(){const s=Array.from(this.$refs.files.files).find(i=>!i.type.includes("image"));if(Array.from(this.$refs.files.files).find(i=>i.size>2097152)){this.$toast.error("File size must not exceed 2MB");return}if(s){this.$toast.error("File type must be image");return}this.files.push(...this.$refs.files.files),this.$refs.files.value=null},deleteImage(s){this.event.files.splice(s,1),this.$store.dispatch("deleteImageService",{index:this.$route.params.id,id:this.event.id})}},watch:{venue:{immediate:!1,handler(s){}}},async created(){await this.$store.dispatch("getVenueService");const s=await this.$store.dispatch("getSingleEventService",this.$route.params.id);this.event=s.data,this.event.start=new Date(this.event.start),this.event.end=new Date(this.event.end),this.venue=this.$store.state.venues.filter(e=>e.id==this.event.venue_id)[0],console.log(this.venue)}},ae=Object.assign(se,{setup(s){return(e,i)=>{const $=p("te-header"),c=p("icon");return o(),d("div",S,[l($),t("form",{class:"p-3",onSubmit:i[6]||(i[6]=k((...n)=>e.updateEvent&&e.updateEvent(...n),["prevent"]))},[F,t("div",U,[t("div",C,[t("div",null,[L,u(t("input",{placeholder:"Le ccusa",autocomplete:"","onUpdate:modelValue":i[0]||(i[0]=n=>e.event.title=n),class:"p-2 border rounded-7 w-100 mb-3"},null,512),[[h,e.event.title]])])]),t("div",B,[t("div",null,[j,u(t("textarea",{"onUpdate:modelValue":i[1]||(i[1]=n=>e.event.description=n),autocomplete:"",placeholder:"A description about the event",class:"p-2 border rounded-7 w-100 mb-3",style:{"min-height":"100px"}},null,512),[[h,e.event.description]])])]),t("div",A,[t("div",N,[T,l(r(w),{modelValue:e.event.start,"onUpdate:modelValue":i[2]||(i[2]=n=>e.event.start=n),placeholder:"starting period of the event","min-date":new Date,showTime:"",class:"rounded-7 w-100"},null,8,["modelValue","min-date"]),t("small",I,[V("Time Zone: "),t("b",null,E(e.event.time_zone),1)])])]),t("div",M,[t("div",O,[R,l(r(w),{modelValue:e.event.end,"onUpdate:modelValue":i[3]||(i[3]=n=>e.event.end=n),placeholder:"end time of the event",showTime:"","min-date":e.event.start,class:"rounded-7 w-100"},null,8,["modelValue","min-date"])])]),t("div",q,[t("div",H,[Z,l(r(z),{modelValue:e.venue,"onUpdate:modelValue":i[4]||(i[4]=n=>e.venue=n),options:e.$store.state.venues,optionLabel:"title",placeholder:"Select a Venue",class:"w-100 mb-1"},null,8,["modelValue","options"])])]),t("div",G,[t("div",J,[K,P,t("label",Q,[t("div",W,[l(c,{icon:"mingcute:add-fill",class:"fs-1 text-white"})])]),l(r(D)),(o(!0),d(v,null,f(e.event.files,(n,m)=>{var a;return o(),d("div",X,[t("img",{class:"w-100 rounded-7 object-fit-cover",src:n},null,8,Y),((a=e.event.files)==null?void 0:a.length)>1||e.files.length>0?(o(),b(c,{key:0,icon:"icons8:cancel",class:"fs-2 pe-point text-danger position-absolute top-0 start-0",onClick:y=>e.deleteImage(m)},null,8,["onClick"])):g("",!0)])}),256)),(o(!0),d(v,null,f(e.files,(n,m)=>{var a;return o(),d("div",x,[t("img",{class:"w-100 rounded-7 object-fit-cover",src:e.getUrl(n)},null,8,ee),((a=e.event.files)==null?void 0:a.length)>0||e.files.length>1?(o(),b(c,{key:0,icon:"icons8:cancel",class:"fs-2 pe-point text-danger position-absolute top-0 start-0",onClick:y=>e.files.splice(m,1)},null,8,["onClick"])):g("",!0)])}),256)),t("input",{type:"file",multiple:"",ref:"files",accept:"images/*",id:"files",hidden:"",onChange:i[5]||(i[5]=(...n)=>e.updateFiles&&e.updateFiles(...n))},null,544)])])]),te],32)])}}});export{ae as default};
